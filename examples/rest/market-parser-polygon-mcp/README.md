# Market Parser with Polygon MCP Server

<div align="center">
  <img src="../../../images/logo.png" alt="Project Logo" width="100%"/>
</div>

A simple Python CLI for natural language financial queries using the [Polygon.io](https://polygon.io/) [MCP server](https://github.com/polygon-io/mcp_polygon) and Anthropic [Claude 4](https://www.anthropic.com/news/claude-4) via the [Pydantic AI Agent Framework](https://ai.pydantic.dev/agents/).

## Features

- **Ask questions like:**  
  `Tesla price now`  
  `AAPL volume last week`  
  `Show me the price of MSFT on 2023-01-01`

- **Rich CLI output:**  
  Answers are formatted for easy reading in your terminal.

## Disclaimer

**Warning:** The examples, demos, and outputs produced with this project are generated by artificial intelligence and large language models. You acknowledge that this project and any outputs are provided "AS IS", may not always be accurate and may contain material inaccuracies even if they appear accurate because of their level of detail or specificity, outputs may not be error free, accurate, current, complete, or operate as you intended, you should not rely on any outputs or actions without independently confirming their accuracy, and any outputs should not be treated as financial or legal advice. You remain responsible for verifying the accuracy, suitability, and legality of any output before relying on it.

---

## Quickstart (with [uv](https://github.com/astral-sh/uv))

1. **Install [uv](https://github.com/astral-sh/uv) if you don’t have it:**
    ```sh
    curl -Ls https://astral.sh/uv/install.sh | sh
    ```

2. **Get your API keys:**
   - [Polygon.io API key](https://polygon.io/)
   - [Anthropic API key (Claude)](https://console.anthropic.com/)

3. **Create a `.env` file in the same directory as `market_parser_demo.py`:**
    ```
    POLYGON_API_KEY=your_polygon_api_key_here
    ANTHROPIC_API_KEY=your_anthropic_api_key_here
    ```
    Both keys are required for the CLI to work.

4. **Run the CLI (dependencies will be auto-installed from `pyproject.toml`):**
    ```sh
    uv run market_parser_demo.py
    ```

5. **Type your question and press Enter!**  
   Type `exit` to quit.

---

## Example Usage

```
> Tesla price now
✔ Query processed successfully!
Agent Response:
$TSLA is currently trading at $XXX.XX (as of 2024-06-07 15:30:00 UTC).
---------------------

> exit
Goodbye!
```

For reference, this is the system prompt used with every query: 

```
system_prompt=(
    "You are an expert financial analyst. Note that when using Polygon tools, prices are already stock split adjusted. "
    "Use the latest data available. Always double check your math. "
    "For any questions about the current date, use the 'get_today_date' tool. "
    "For long or complex queries, break the query into logical subtasks and process each subtask in order."
)
```

Be speficific in your prompt. The better the prompt - the better the response.

---

## Troubleshooting

- **Missing API Key:**  
  If you see an error about `POLYGON_API_KEY` or `ANTHROPIC_API_KEY`, make sure your `.env` file is in the same directory and contains both keys:
  ```
  POLYGON_API_KEY=your_polygon_api_key_here
  ANTHROPIC_API_KEY=your_anthropic_api_key_here
  ```

- **Dependencies:**  
  If you get `ModuleNotFoundError`, make sure your `pyproject.toml` lists:
    - `python-dotenv`
    - `rich`
    - `pydantic_ai`

  If you prefer, you can use pip instead:
  ```sh
  pip install python-dotenv rich pydantic_ai
  python market_parser_demo.py
  ```

- **Incorrect Responses**
AI Data can be incorrect. Like all LLM generated responses, please double check 

- **Other errors:**  
  All errors are printed in red in the terminal for easy debugging.
  If you get a 529, anthropic is rate limiting your requests.

---

## How it Works

- Loads your Polygon and Anthropic API keys from `.env`
- Starts the Polygon MCP server in the background
- Sends your natural language query to Anthropic Claude via PydanticAI
- Prints the answer in a readable format

---

---

## Enhancement Ideas

- Historical memory from previous chats
- Better error handling based on error codes
- Prompt chunking into individual tasks 
- Other tools or MCPs servers added to the agentic flow

---

## License

This project is licensed under the [MIT License](../../../LICENSE).