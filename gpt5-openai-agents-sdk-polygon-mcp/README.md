# GPT-5 OpenAI Agents SDK with Polygon.io MCP â€” Agentic Financial Analyst

A comprehensive Python application with CLI, FastAPI server, and React frontend for natural language financial queries using [GPTâ€‘5](https://openai.com/gpt-5/) via the [OpenAI](https://openai.com/) [Agents SDK](https://openai.github.io/openai-agents-python/) and the [Polygon.io](https://polygon.io/) [MCP server](https://github.com/polygon-io/mcp_polygon). Features include markdown reports, responsive web interface, and production-ready deployment capabilities.

## Features

### Multi-Interface Access
- **CLI Interface**: Enhanced terminal experience with emoji-based sentiment indicators
- **FastAPI Server**: RESTful API with comprehensive endpoints for financial analysis
- **React Frontend**: Modern responsive web interface with TypeScript support

### Financial Analysis Capabilities
- **Ask questions like:**  
  - `last trade for AAPL`  
  - `aggregates for MSFT from 2024-01-01 to 2024-03-01 daily`  
  - `ticker details TSLA`
  - `analyze the return on investment between microsoft and meta. review news, ratings, earning. save a report`

### Enhanced User Experience
- **Rich CLI output**: Terminal responses with enhanced formatting and emoji sentiment indicators
- **Button Prompts**: Quick-access analysis buttons for snapshot, technical, and support/resistance analysis
- **Markdown Reports**: Automatic report generation saved under `reports/<category>/...`
- **Cross-Platform Responsive Design**: Optimized for desktop, tablet, and mobile devices
- **Real-time Chat Interface**: Live interaction with loading states and error handling

## Disclaimer

**Warning:** The examples, demos, and outputs produced with this project are generated by artificial intelligence and large language models. You acknowledge that this project and any outputs are provided "AS IS", may not always be accurate and may contain material inaccuracies even if they appear accurate because of their level of detail or specificity, outputs may not be error free, accurate, current, complete, or operate as you intended, you should not rely on any outputs or actions without independently confirming their accuracy, and any outputs should not be treated as financial or legal advice. You remain responsible for verifying the accuracy, suitability, and legality of any output before relying on it.

---

## Quick Start

### Prerequisites

1. **Install [uv](https://github.com/astral-sh/uv) if you don't have it:**
    ```bash
    curl -Ls https://astral.sh/uv/install.sh | sh
    ```

2. **Get your API keys:**
   - [OpenAI API key](https://platform.openai.com/api-keys)
   - [Polygon.io API key](https://polygon.io/)

3. **Environment Setup:**
    ```bash
    # Copy the example environment file
    cp .env.example .env
    
    # Edit .env with your API keys
    OPENAI_API_KEY=sk-your_openai_key_here
    POLYGON_API_KEY=your_polygon_api_key_here
    ```

### Installation & Usage

#### Option 1: CLI Interface
```bash
# Run the enhanced CLI with emoji sentiment indicators
uv run src/main.py

# Type your financial questions and press Enter!
# Type 'exit' to quit.
```

#### Option 2: FastAPI Server + Optimized React Frontend
```bash
# Terminal 1: Start FastAPI server
uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload

# Terminal 2: Start Vite-optimized React frontend
cd frontend_OpenAI
npm install
npm run dev  # Development with local API (optimized startup ~337ms)

# Alternative environment builds:
# npm run dev:staging     # Staging environment development
# npm run build          # Production build with PWA and optimizations
# npm run build:staging  # Staging environment build
# npm run analyze        # Bundle analysis with performance insights
# npm run lighthouse     # Lighthouse CI performance validation

# Open http://localhost:3000 for the web interface
```

**Vite Optimization Highlights:**
- **45% Bundle Size Reduction**: Main bundle optimized from 68KB to 37.19KB
- **Progressive Web App**: Auto-generated PWA with offline capabilities
- **Multi-Environment Support**: Development, staging, and production configurations
- **Zero Code Quality Issues**: All ESLint and TypeScript validations passing
- **Advanced Performance Features**: Code splitting, lazy loading, and Lighthouse CI monitoring

#### Option 3: Legacy CLI (Original)
```bash
# Legacy CLI interface (still supported)
uv run main.py
```

---

## Example Usage

### CLI Interface
```bash
> last trade for AAPL
âœ” Query processed successfully!
ğŸ“ˆ Agent Response:
$AAPL last trade: $XXX.XX at 2025-08-13 15:30:00 UTC

ğŸ¯ KEY TAKEAWAYS
ğŸ“ˆ Stock price at recent high
ğŸ’° Trading volume above average
ğŸ“Š Market sentiment: Bullish
---------------------

> exit
Goodbye!
```

### Web Interface Features
- **Button Prompts**: Quick-access buttons for snapshot, technical, and support/resistance analysis
- **Real-time Chat**: Interactive conversation with loading states
- **Responsive Design**: Works seamlessly on desktop, tablet, and mobile
- **Markdown Support**: Rich formatting for analysis results

### Analysis Agent Workflow
The financial analysis agent follows these steps:
1. **Guardrail Verification**: Ensure finance-related queries
2. **Data Gathering**: Collect market data via Polygon.io tools
3. **AI Analysis**: Process data using GPT-5 with financial expertise
4. **Emoji Indicators**: Add sentiment indicators (ğŸ“ˆ bullish, ğŸ“‰ bearish)
5. **Report Generation**: Offer to save detailed markdown reports

### Advanced Example
```bash
> Do a return on investment analysis of Meta vs Microsoft. Review news, sentiment, rating, earnings. Analyze the results. Save a report.
```

This will generate a comprehensive report saved to `reports/equities/meta_vs_microsoft_analysis.md` with:
- Detailed financial comparison
- News sentiment analysis
- Earnings analysis
- Investment recommendations
- Risk assessment

---

## Troubleshooting

### Environment Issues
- **Missing API Key:**  
  If you see an error about `POLYGON_API_KEY` or `OPENAI_API_KEY`, ensure your `.env` file contains both keys:
  ```bash
  OPENAI_API_KEY=sk-your_key_here
  POLYGON_API_KEY=your_polygon_key_here
  ```

- **`uvx: command not found`:**  
  Install `uv` with `curl -Ls https://astral.sh/uv/install.sh | sh` or `pip install uv`.

### Installation Issues
- **Dependencies:**  
  `uv run` will install from `pyproject.toml`. For manual installation:
  ```bash
  uv install  # Installs all dependencies
  # Or with pip:
  pip install openai-agents pydantic rich python-dotenv openai fastapi uvicorn
  ```

### Frontend Issues
- **React frontend won't start:**
  ```bash
  cd frontend_OpenAI
  rm -rf node_modules package-lock.json
  npm install
  npm run dev  # Optimized Vite development server
  ```

- **CORS errors:**  
  Ensure FastAPI server is running on port 8000 and React on port 3000. The Vite proxy configuration automatically handles API routing.

- **Environment-specific issues:**
  ```bash
  # Check environment configuration
  npm run dev:staging      # Test staging environment
  npm run build:development # Test development build
  npm run type-check       # Validate TypeScript (should show zero errors)
  npm run lint            # Validate ESLint (should show zero errors)
  ```

- **Performance validation:**
  ```bash
  npm run analyze         # Generate bundle analysis report
  npm run lighthouse      # Run performance testing
  # Reports available at dist/bundle-analysis.html
  ```

### Runtime Issues
- **Guardrail blocks nonâ€‘finance prompts:**  
  Try a market or finance-related query.

- **Port conflicts:**
  - FastAPI: Use `--port 8001` if 8000 is occupied
  - React: Use `PORT=3001 npm run dev` if 3000 is occupied

- **Error reporting:**  
  All errors are displayed with detailed messages for debugging.

---

## Architecture Overview

### System Components
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Frontend â”‚    â”‚  FastAPI Server â”‚    â”‚ Analysis Engine â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Button Prompts  â”‚â—„â”€â”€â–ºâ”‚ 8+ REST Endpointsâ”‚â—„â”€â”€â–ºâ”‚ GPT-5 Agent     â”‚
â”‚ Chat Interface  â”‚    â”‚ Pydantic Models â”‚    â”‚ Polygon.io MCP  â”‚
â”‚ Responsive UI   â”‚    â”‚ CORS Middleware â”‚    â”‚ Report Generatorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### How It Works
1. **Environment Setup**: Loads API keys from `.env` file
2. **MCP Server**: Automatically starts Polygon.io MCP server via `uvx`
3. **Agent Framework**: Runs GPT-5 analysis agent with financial guardrails
4. **Multi-Interface**: 
   - CLI: Direct terminal interaction with rich formatting
   - API: RESTful endpoints for programmatic access
   - Web: React frontend with button prompts and chat interface
5. **Report Generation**: Saves formatted analyses to `reports/<category>/...`
6. **State Management**: Maintains conversation context across interfaces

---

## Development & Testing

### Development Setup
```bash
# Clone and setup
git clone https://github.com/your-repo/gpt5-openai-agents-sdk-polygon-mcp.git
cd gpt5-openai-agents-sdk-polygon-mcp

# Install dependencies
uv install

# Setup environment
cp .env.example .env
# Edit .env with your API keys

# Frontend setup with Vite optimizations
cd frontend_OpenAI
npm install  # Installs optimized dependencies including Vite PWA and Lighthouse CI

# Run tests
uv run pytest tests/ -v  # Backend tests
npm run type-check      # Frontend TypeScript validation (zero errors)
npm run lint           # Frontend ESLint validation (zero errors)
```

### Vite Optimization Validation
```bash
# Performance and build validation
cd frontend_OpenAI

# Validate all build environments work
npm run build:development  # Development build validation
npm run build:staging     # Staging build validation  
npm run build            # Production build with PWA validation

# Performance testing and analysis
npm run analyze         # Bundle size analysis (should show 45% reduction)
npm run lighthouse      # Performance validation (targets: >85% performance, >90% PWA)

# Code quality validation (should show zero errors)
npm run lint           # ESLint validation
npm run type-check     # TypeScript validation
npm run format:check   # Prettier formatting validation
```

### Project Structure
```
gpt5-openai-agents-sdk-polygon-mcp/
â”œâ”€â”€ src/                    # Main application source
â”‚   â”œâ”€â”€ __init__.py        # Package initialization
â”‚   â”œâ”€â”€ main.py            # Enhanced CLI & FastAPI server
â”‚   â”œâ”€â”€ api_models.py      # Pydantic validation models
â”‚   â””â”€â”€ ...                # Additional modules
â”œâ”€â”€ frontend_OpenAI/        # React frontend
â”‚   â”œâ”€â”€ src/               # React components & services
â”‚   â”œâ”€â”€ package.json       # Frontend dependencies
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tests/                  # Test suites (85% backend coverage)
â”œâ”€â”€ reports/               # Generated analysis reports
â”œâ”€â”€ docs/                  # Documentation
â”œâ”€â”€ .env.example           # Environment template
â”œâ”€â”€ pyproject.toml         # Python dependencies
â””â”€â”€ README.md             # This file
```

### Testing
- **Backend Tests**: 85% coverage with comprehensive validation
- **Integration Tests**: Full API workflow testing
- **Frontend Tests**: Component and service testing
- **Security Tests**: Input validation and XSS prevention

### Code Quality
- **PyLint Integration**: Automated code quality checks
- **TypeScript Support**: Full type safety in frontend
- **Error Handling**: Comprehensive error boundaries
- **Security**: Input validation and sanitization

## Future Enhancements

### Planned Features
- Multi-agent handoffs for specialized analysis (news, fundamentals, technicals)
- Advanced caching with Redis for improved performance
- Real-time data streaming with WebSocket support
- Enhanced security with OAuth2 authentication
- Advanced visualization with interactive charts

### Configuration Options
- YAML/ENV configuration for model selection
- Date-range caps and per-tool rate limits
- Retry policies and timeout configuration
- Custom prompt templates and analysis types

---

## License

This project is licensed under the MIT License. See the LICENSE file for details.
